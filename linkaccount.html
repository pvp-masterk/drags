<html>
<head>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- ðŸ”— Load header file -->
<div id="header-placeholder"></div>

<!-- ðŸ‘‡ Header toggle button -->
<button id="toggleHeaderBtn">ðŸ”» Disable Header</button>

  
  <div class="container">
    <div class="card slide-up">
      <h1>Login with Discord</h1>
      <a href="https://discord.com/api/oauth2/authorize?client_id=1392907277463457792&redirect_uri=https%3A%2F%2Fdragswebapp.vercel.app%2Fapi%2Fauth&response_type=code&scope=identify">
        <button>Login</button>
      </a>
    </div>
  </div>
  <script>
  // ðŸ§  Load mainheader.html
  fetch("mainheader.html")
    .then(res => res.text())
    .then(html => {
      document.getElementById("header-placeholder").innerHTML = html;
      applyHeaderPreference();
      loadUserInfo();
      setupDropdownToggle();
    });

  // ðŸ§  Toggle header on/off
  const toggleBtn = document.getElementById("toggleHeaderBtn");

  toggleBtn.addEventListener("click", () => {
    const header = document.getElementById("header-placeholder");
    const hidden = header.classList.toggle("hidden-header");
    localStorage.setItem("hideHeader", hidden ? "1" : "0");
    toggleBtn.textContent = hidden ? "ðŸ”¼ Enable Header" : "ðŸ”» Disable Header";
  });

  function applyHeaderPreference() {
    const shouldHide = localStorage.getItem("hideHeader") === "1";
    const header = document.getElementById("header-placeholder");
    if (shouldHide) {
      header.classList.add("hidden-header");
      toggleBtn.textContent = "ðŸ”¼ Enable Header";
    } else {
      header.classList.remove("hidden-header");
      toggleBtn.textContent = "ðŸ”» Disable Header";
    }
  }

  function loadUserInfo() {
    const miniAvatar = document.getElementById("miniAvatar");
    const editProfile = document.getElementById("editProfile");

    const userId = localStorage.getItem("discord_id");
    const avatarUrl = localStorage.getItem("avatar_url");

    if (userId && avatarUrl && miniAvatar && editProfile) {
      miniAvatar.src = avatarUrl;
      miniAvatar.style.display = "block";
      editProfile.href = `settings.html?discord_id=${userId}`;
    }
  }

  function setupDropdownToggle() {
    const avatar = document.getElementById("miniAvatar");
    const dropdown = document.getElementById("dropdown");

    avatar?.addEventListener("click", () => {
      dropdown.classList.toggle("show");
    });

    window.addEventListener("click", (e) => {
      if (!avatar.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.classList.remove("show");
      }
    });
  }
</script>

</body>
</html>
