<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Settings | Drags</title>
   <link rel="icon" href="drags.png" type="image/png">
  <link rel="stylesheet" href="style.css" />
  <style>
     :root {
            --primary: #5865F2;
            --primary-dark: #4752C4;
            --secondary: #57F287;
            --text: #f5f5f5;
            --bg: #1e1e2e;
            --card-bg: #2a2a3a;
            --accent: #ED4245;
        }
    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 40px;
    }

    .settings-container {
      max-width: 600px;
      margin: auto;
      background: var(--card-bg);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }

    .settings-container h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-top: 20px;
      font-weight: 500;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border-radius: 8px;
      border: none;
      background: #2f2f45;
      color: white;
    }

    textarea {
      resize: vertical;
    }

    .save-btn {
      margin-top: 30px;
      width: 100%;
      background: var(--primary);
      border: none;
      color: white;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    .save-btn:hover {
      background: var(--primary-dark);
    }
    .badge-section {
  background: #2b2b3e;
  border-radius: 10px;
  padding: 10px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 10px;
}

.badge-item {
  background: #3a3a55;
  color: white;
  padding: 6px 10px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
}

.badge-item button {
  background: transparent;
  border: none;
  color: var(--secondary);
  cursor: pointer;
  font-weight: bold;
}
.select-theme-btn {
  margin-top: 10px;
  padding: 10px 20px;
  background: var(--primary);
  border: none;
  color: white;
  font-weight: bold;
  border-radius: 8px;
  cursor: pointer;
}

.theme-modal {
  position: fixed;
  top: 0;
  left: 0;
  display: none;
  width: 100%;
  height: 100%;
  background: rgba(20, 20, 30, 0.8);
  backdrop-filter: blur(6px);
  z-index: 999;
  justify-content: center;
  align-items: center;
}

.theme-modal-content {
  background: var(--card-bg);
  padding: 30px;
  border-radius: 16px;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 0 30px rgba(0,0,0,0.5);
  text-align: center;
}

.theme-options {
  display: flex;
  flex-direction: column;
  gap: 20px;
  margin: 20px 0;
}

.theme-card {
  background: #25253b;
  border-radius: 12px;
  padding: 10px;
  cursor: pointer;
  transition: 0.3s ease;
  text-align: center;
}

.theme-card:hover {
  background: #2f2f4f;
}

.gradient {
  height: 60px;
  border-radius: 10px;
  margin-bottom: 6px;
}

.gradient.majestic {
  background: linear-gradient(135deg, #1c2e6c, #3e64ff);
}

.gradient.fractal {
  background: linear-gradient(135deg, #eeeeee, #c0c0c0);
}

.gradient.drags-featured {
  background: linear-gradient(135deg, #1c2e6c, #000000);
  position: relative;
}

.featured-label {
  position: absolute;
  top: 5px;
  right: 10px;
  font-size: 11px;
  background: var(--primary);
  color: white;
  padding: 2px 6px;
  border-radius: 6px;
  font-weight: bold;
}
input[type="text"], select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 8px;
  background: #2f2f45;
  color: white;
  border: none;
}
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #2e2e3e;
  color: white;
  padding: 12px 20px;
  border-left: 6px solid var(--primary);
  border-radius: 10px;
  font-size: 14px;
  z-index: 9999;
  opacity: 0;
  pointer-events: none;
  transform: translateY(20px);
  transition: all 0.4s ease;
}

.toast.show {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.toast.error {
  border-left-color: var(--accent);
}

  </style>
</head>
<body>
  <div class="settings-container">
    <h2>⚙️ Profile Settings</h2>

    <label for="displayName">Display Name</label>
    <input type="text" id="displayName" placeholder="Your display name" />

    <label for="bio">Bio</label>
    <textarea id="bio" placeholder="Write something about you..."></textarea>
    <label for="badgeSection">Badges to Show</label>
<div id="badgeSection" class="badge-section"></div>
    <label for="themeSelector">Profile Theme</label>
<button class="select-theme-btn" onclick="openThemeModal()">Select Theme</button>
<div id="selectedThemeLabel" style="margin-top: 10px; font-size: 14px; color: var(--secondary);"></div>

<!-- Modal -->
<div id="themeModal" class="theme-modal">
  <div class="theme-modal-content">
    <h3>Select Your Theme</h3>
    <div class="theme-options">
      <div class="theme-card" data-theme="majestic">
        <div class="gradient majestic"></div>
        <span>Majestic</span>
      </div>
      <div class="theme-card" data-theme="fractal">
        <div class="gradient fractal"></div>
        <span>Fractal</span>
      </div>
      <div class="theme-card" data-theme="drags_featured">
        <div class="gradient drags-featured">
          <span class="featured-label">Featured</span>
        </div>
        <span>Drags Featured</span>
      </div>
    </div>
    <button onclick="closeThemeModal()" class="close-modal">Close</button>
  </div>
</div>
   

<label>Username Effect</label>
<select id="usernameEffect">
  <option value="">None</option>
  <option value="rainbow">Rainbow Gradient</option>
  <option value="glow">Shiny</option>
</select>


<div id="toast" class="toast"></div>


    <button class="save-btn" onclick="saveSettings()">Save Settings</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
  <script>
    const supabase = window.supabase.createClient(
      "https://akektlyhqzbatuedgnuq.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFrZWt0bHlocXpiYXR1ZWRnbnVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIyMjUwNzUsImV4cCI6MjA2NzgwMTA3NX0.NqsB9Gj4_ZbZw9DgLiLxz2hwEyQvd7tCYy-drMbLGCg"
    );

    const discordId = localStorage.getItem("loggedInDiscordId");
let badgeOrder = [];
let originalSettings = {};

    async function loadSettings() {
      const { data, error } = await supabase
        .from("users")
        .select("display_name, bio")
        .eq("discord_id", discordId)
        .single();

      if (data) {
        document.getElementById("displayName").value = data.display_name || "";
        document.getElementById("bio").value = data.bio || "";
document.getElementById("usernameEffect").value = data.username_effect || "";

      }
      originalSettings = {
  displayName: data.display_name || "",
  bio: data.bio || "",
  effect: data.username_effect || "",
  theme: data.profile_theme || "",
  badges: JSON.stringify(data.badges || [])
};
window.onbeforeunload = () => {
  const current = {
    displayName: document.getElementById("displayName").value,
    bio: document.getElementById("bio").value,
    cardBg: document.getElementById("cardBgInput").value,
    pageBg: document.getElementById("pageBgInput").value,
    effect: document.getElementById("usernameEffect").value,
    theme: selectedTheme,
    badges: JSON.stringify(badgeOrder)
  };

  for (let key in current) {
    if (current[key] !== originalSettings[key]) {
      return "You have unsaved changes!";
    }
  }
};

    }

async function saveSettings() {
  const displayName = document.getElementById("displayName").value;
  const bio = document.getElementById("bio").value;
  const usernameEffect = document.getElementById("usernameEffect").value;

  const { error } = await supabase
    .from("users")
    .update({
      display_name: displayName,
      bio,
      badges: badgeOrder,
      profile_theme: selectedTheme,
      username_effect: usernameEffect
    })
    .eq("discord_id", discordId);

  if (!error) {
    showToast("✅ Settings saved successfully.");
    originalSettings = {
      displayName, bio,
      cardBg, pageBg,
      effect: usernameEffect,
      theme: selectedTheme,
      badges: JSON.stringify(badgeOrder)
    };
  } else {
    showToast("❌ Failed to save settings.", true);
    console.error(error);
  }
}











    loadSettings();
   loadBadges();


async function loadBadges() {
  const { data, error } = await supabase
    .from("users")
    .select("badges")
    .eq("discord_id", discordId)
    .single();

  badgeOrder = data?.badges || [];
  renderBadgeSection();
}

 

function renderBadgeSection() {
  const section = document.getElementById("badgeSection");
  section.innerHTML = "";

  if (!badgeOrder || badgeOrder.length === 0) {
    section.innerHTML = "<p style='color:gray;'>No badges selected.</p>";
    return;
  }

  badgeOrder.forEach((badge, index) => {
    const div = document.createElement("div");
    div.className = "badge-item";
    div.innerHTML = `
      ${badge}
      ${index > 0 ? `<button onclick="moveBadge(${index}, -1)">⬅</button>` : ""}
      ${index < badgeOrder.length - 1 ? `<button onclick="moveBadge(${index}, 1)">➡</button>` : ""}
    `;
    section.appendChild(div);
  });
}

function moveBadge(index, direction) {
  const newIndex = index + direction;
  [badgeOrder[index], badgeOrder[newIndex]] = [badgeOrder[newIndex], badgeOrder[index]];
  renderBadgeSection();
}

let selectedTheme = "";

function openThemeModal() {
  document.getElementById("themeModal").style.display = "flex";
}

function closeThemeModal() {
  document.getElementById("themeModal").style.display = "none";
}

document.querySelectorAll(".theme-card").forEach(card => {
  card.addEventListener("click", () => {
    selectedTheme = card.dataset.theme;
    document.getElementById("selectedThemeLabel").textContent = `Selected Theme: ${formatThemeName(selectedTheme)}`;
    closeThemeModal();
  });
});

function formatThemeName(id) {
  if (id === "majestic") return "Majestic";
  if (id === "fractal") return "Fractal";
  if (id === "drags_featured") return "Drags Featured";
  return id;
}
function showToast(message, isError = false) {
  const toast = document.getElementById("toast");
  toast.textContent = message;
  toast.className = "toast show" + (isError ? " error" : "");
  setTimeout(() => {
    toast.classList.remove("show");
  }, 3000);
}

  </script>
</body>
</html>
